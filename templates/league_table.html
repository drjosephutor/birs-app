{% extends "base.html" %}
{% block title %}ATO Performance League Table{% endblock %}

{% block content %}
<div class="container-fluid px-3">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h2 class="fw-bold">ğŸ† ATO Performance League Table</h2>
    <a href="{{ url_for('dashboard') }}" class="btn btn-outline-secondary">â† Back to Dashboard</a>
  </div>

  <!-- ğŸ“… Date Range Filter -->
  <form method="get" action="{{ url_for('league_table') }}" class="mb-4">
    <div class="row g-3 align-items-end">
      <div class="col-md-4">
        <label for="from_date" class="form-label">From Date</label>
        <input type="date" name="from_date" id="from_date" class="form-control"
               value="{{ from_date or '' }}">
      </div>
      <div class="col-md-4">
        <label for="to_date" class="form-label">To Date</label>
        <input type="date" name="to_date" id="to_date" class="form-control"
               value="{{ to_date or '' }}">
      </div>
      <div class="col-md-4">
        <button type="submit" class="btn btn-primary w-100">Apply Filter</button>
      </div>
    </div>
  </form>

  <!-- ğŸ—“ Date Range Info -->
  {% if from_date and to_date %}
    <h5 class="text-muted mb-4 text-center">
      Showing results from <strong>{{ from_date }}</strong> to <strong>{{ to_date }}</strong>
    </h5>
  {% endif %}

  <!-- ğŸ… League Table -->
  <div class="table-responsive shadow-sm">
    <table class="table table-striped table-hover align-middle">
      <thead class="table-primary text-center">
        <tr>
          <th scope="col">ğŸ… Rank</th>
          <th scope="col">ğŸ‘¤ ATO</th>
          <th scope="col">ğŸ¯ Target (â‚¦)</th>
          <th scope="col">ğŸ’³ RRR (â‚¦)</th>
          <th scope="col">ğŸ¦ Paydirect (â‚¦)</th>
          <th scope="col">ğŸ’° Total Actual (â‚¦)</th>
          <th scope="col">ğŸ“ˆ % Achieved</th>
          <th scope="col">ğŸ” Details</th>
        </tr>
      </thead>
      <tbody class="text-center">
        {% if league %}
          {% for entry in league %}
          <tr class="{% if loop.index == 1 %}table-success{% elif loop.index == 2 %}table-info{% elif loop.index == 3 %}table-warning{% endif %}">
            <td><strong>{{ loop.index }}</strong></td>
            <td class="text-start fw-semibold">{{ entry.ATO }}</td>
            <td>{{ "{:,.2f}".format(entry.Target) }}</td>
            <td>{{ "{:,.2f}".format(entry.RRR) }}</td>
            <td>{{ "{:,.2f}".format(entry.Paydirect) }}</td>
            <td>{{ "{:,.2f}".format(entry.Actual) }}</td>
            <td class="fw-bold
                {% if entry.Percent >= 100 %}text-success
                {% elif entry.Percent >= 75 %}text-primary
                {% elif entry.Percent >= 50 %}text-warning
                {% else %}text-danger{% endif %}">
              {{ "%.1f"|format(entry.Percent) }}%
            </td>
            <td>
              <a href="{{ url_for('ato_detail', user_id=entry.user_id, from_date=from_date, to_date=to_date) }}" class="btn btn-sm btn-outline-primary">
                View
              </a>
            </td>
          </tr>
          {% endfor %}
        {% else %}
          <tr>
            <td colspan="8" class="text-muted text-center py-4">
              No data available for the selected date range.
            </td>
          </tr>
        {% endif %}
      </tbody>
    </table>
  </div>
</div>
{% endblock %}
